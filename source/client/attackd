#!/bin/bash

. /etc/attackd.conf

[[ $ATTACK_LOG ]] || { echo "Missing var ATTACK_LOG"; }
[[ $ATTACK_DEBUG ]] || { echo "Missing var ATTACK_DEBUG"; }
[[ $ATTACK_LOCK ]] || { echo "Missing var ATTACK_LOCK"; }
[[ $ATTACK_RUN ]] || { echo "Missing var ATTACK_RUN"; }
[[ $AUTO_START ]] || { echo "Missing var AUTO_START"; }

log() { echo "$(date) : $@" | tee -a $ATTACK_LOG; }

daemon() {
   while true; do
      sleep 5
      [ -f $ATTACK_RUN ] || continue
      /usr/lib/lib.attack >> $ATTACK_DEBUG 2>&1 && { log "Attack Success"; } || { log "Attack Fail"; }
   done
}

[ -f $ATTACK_LOCK ] && { echo "Lock file $ATTACK_LOCK exist. Not starting"; exit 2; }
touch $ATTACK_LOCK
touch $ATTACK_DEBUG
touch $ATTACK_LOG
[ "$AUTO_START" == "true" ] && touch $ATTACK_RUN
daemon &
