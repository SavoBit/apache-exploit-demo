# apache-exploit

Apache exploit is a simple demonstration of the apache struts vulnerability
(CVE-2017-9805) inside a single Kubernetes namespace. There are no external
dependencies other then the cluster DNS. The purpose of running inside a
Kubernetes namespace is simplicity. This demo is intended to show how
Aporto protects from the Apache Struts vulnerability and is not intended to
demonstrate a real Kubernetes application.

## Components

There are three components each corresponding to a single container.

- Server is a apache struts server with the vulnerability (CVE-2017-9805)
- Client represents an external attacker
- Controller represents an external control system under control of the attacker

## Attack

The client will automatically attempt to connect to the server every 5 seconds and send the exploit. The exploit is the command "curl controller". If the attempt is successfull then the server will connect to the controller. This is the only reason that the server should ever connect to the controller.

## Demo

There are multiple parts to the attack kill chain that we can demo.

- The server should not be able to connect to the controller
- Aporeto can stop the server from calling exec/fork
- Aporeto detects the vulnerability as a CVE (THIS DOES NOT CURRENTLY WORK)

## Deployment

Clone the repo and change directory

```bash
git clone https://github.com/aporeto-inc/apache-exploit-demo.git
cd apache-exploit-demo
```

Edit the file env as desired and source into shell environment

```bash
source env
```

Install the Aporeto policy and Kubernetes config

```bash
apoctl api import --file policy/policy.yaml -n $FQ_NAMESPACE
kubectl create -f deployments/kubernetes
```
