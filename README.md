# apache-exploit

## Description

Apache exploit is a simple demonstration of the apache struts vulnerability
(CVE-2017-9805) inside a single Kubernetes namespace. There are no external
dependencies other then the cluster DNS. The purpose of running inside a
Kubernetes namespace is simplicity. This demo is intended to show how
Aporto protects from the Apache Struts vulnerability and is not intended to
demonstrate a real Kubernetes application.  The client will automatically
attempt to connect to the server every 5 seconds and send the exploit. The
exploit is the command "curl controller". If the attempt is successfull then
the server will connect to the controller. This is the only reason that the
server should ever connect to the controller.

## Components

There are three components each corresponding to a single container.

- Server is a apache struts server with the vulnerability (CVE-2017-9805)
- Client represents an external attacker
- Controller represents an external control system under control of the attacker

## Kill Chain Demo

There are multiple parts to the attack kill chain that we can demo.

- The server should not be able to connect to the controller
- Aporeto can stop the server from calling exec/fork
- Aporeto detects the vulnerability as a CVE (THIS DOES NOT CURRENTLY WORK)

## Deployment

Clone the repo and change directory into user. Set the shell variables
APOCTL_NAMESPACE and APOCTL_TOKEN. Then execute deploy.sh. When you are
finished execute cleanup.sh which will delete the kubernetes namespace and
the Aporeto config as it exist in this namespace.  You can use the utility
"client.shell" to easily connect to the attack client. You can then use the
command "attack" to view the attack status, stop the attack or restart the
attack. The attack starts by default when the container is created.

Deploy Example
```bash
git clone https://github.com/aporeto-inc/apache-exploit-demo.git
cd apache-exploit-demo/user
APOCTL_TOKEN=FOO
APOCTL_NAMESPACE=/account/kubernetes/kubens
./deploy.sh
```

CLeanup Example
```bash
./cleanup.sh
```
